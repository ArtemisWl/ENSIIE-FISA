#!/bin/sh

if [ $# -gt 2 ]; then
    echo "Usage: $0 <option> <directory1>"
    exit 1
fi

if [ $# -eq 1 ]; then
    if [ ! -d "$1" ]; then
        echo "error: '$1' does not exist or is not a directory 1"
        exit 2
    else
        users=$(find $1 -type f -exec stat --format="%U" {} \; | sort | uniq -c | sort -n | head -n 1)
        echo $users
    fi
else
    if [ ! -d "$2" ]; then
        echo "error: '$1' does not exist or is not a directory 2"
        exit 2
    else 
        if [ "$1" = "-s" ]; then
            users=$(find $2 -type f -exec stat --format="%U" {} \; | sort | uniq)
            taille=0
            nb=0
            for usr in $users; do
                size=$(find $2 -type f -exec stat --format="%U %s" {} \; | grep $usr | sed -E 's/^[^ ]+ +([^ ]+).*/\1/')
                for sz in $size; do 
                nb=$((nb+1))
                    taille=$((taille+sz))
                done
                echo $nb $usr $taille
            done
        else
            echo "error: '$1' is not an option for this script"
            exit 2
        fi
    fi
fi

exit 0