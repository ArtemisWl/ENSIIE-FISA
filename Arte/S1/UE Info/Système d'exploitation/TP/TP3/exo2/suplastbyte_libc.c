#include <stdio.h>
#include <stdlib.h>

int main(int argc, char *argv[]) {
   
    if (argc != 2) {
        fprintf(stderr, "Usage: %s <file>\n", argv[0]);
        return EXIT_FAILURE;
    }

    const char *filepath = argv[1];
    FILE *file = fopen(filepath, "rw");
    if (file == NULL) {
        perror("Error opening file");
        return EXIT_FAILURE;
    }

    if (fseek(file, 0, SEEK_END) != 0) {
        perror("Error seeking to end of file");
        fclose(file);
        return EXIT_FAILURE;
    }

    long file_size = ftell(file);
    if (file_size == -1) {
        perror("Error getting file size");
        fclose(file);
        return EXIT_FAILURE;
    }

    if (file_size == 0) {
        fprintf(stderr, "File is empty\n");
        fclose(file);
        return EXIT_FAILURE;
    }

    rewind(file);

    char *buffer = malloc((file_size - 1) * sizeof(char));
    if (buffer == NULL) {
        perror("Error allocating memory");
        fclose(file);
        return EXIT_FAILURE;
    }

    if (fread(buffer, sizeof(char), file_size - 1, file) != (long unsigned int) (file_size - 1)) {
        perror("Error reading file");
        free(buffer);
        fclose(file);
        return EXIT_FAILURE;
    }

    if(buffer[file_size - 1] == '\0') {
        printf("1");
        char *buffer_new = malloc((file_size - 1) * sizeof(char));
        for(int i; i<file_size-1; i++) {
            buffer_new[i] = buffer[i];
        }
        size_t bytes_written = fwrite(buffer_new, sizeof(char), file_size-2, file);
        if (bytes_written == (long unsigned int) -1) {
            perror("Error writing to file");
            free(buffer);
            free(buffer_new);
            fclose(file);
            return EXIT_FAILURE;
        }
        free(buffer_new);
    }
    else {
        printf("2");
        buffer[file_size - 1] = '\0';
        size_t bytes_written = fwrite(buffer, sizeof(char), file_size-1, file);
        if (bytes_written == (long unsigned int) -1) {
            perror("Error writing to file");
            free(buffer);
            fclose(file);
            return EXIT_FAILURE;
        }
    }

    free(buffer);
    fclose(file);

    return EXIT_SUCCESS;
}